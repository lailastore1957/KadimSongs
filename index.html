<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>كل أغاني كاظم الساهر – حسب السنة</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {{
      --bg: #0f1115;
      --card: #161a22;
      --text: #f5f7fb;
      --muted: #9aa3b2;
      --accent: #d4b277; /* لمسة ذهبية خفيفة */
      --accent-2: #2d7df6;
      --radius: 14px;
    }}
    * {{ box-sizing: border-box; }}
    html, body {{ margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: "Tajawal", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }}
    a {{ color: var(--accent-2); text-decoration: none; }}
    .wrap {{ max-width: 1100px; margin: 0 auto; padding: 24px; }}
    header.hero {{
      background: linear-gradient(180deg, rgba(212,178,119,0.12), transparent 60%);
      padding: 28px 0 10px;
    }}
    .title {{ font-size: clamp(24px, 3.4vw, 40px); margin: 0 0 6px; letter-spacing: .2px; }}
    .subtitle {{ margin: 0; color: var(--muted); font-size: 15px; }}
    .search-row {{ display: grid; grid-template-columns: 1fr auto; gap: 12px; margin-top: 18px; align-items: center; }}
    .input {{ background: var(--card); border: 1px solid #232a36; border-radius: var(--radius); padding: 14px 16px; color: var(--text); font-size: 16px; outline: none; }}
    .input::placeholder {{ color: #7c8597; }}
    .btn {{ border: 1px solid #2a3342; background: #1b2130; color: var(--text); padding: 12px 16px; border-radius: 10px; cursor: pointer; font-size: 15px; }}
    .btn:hover {{ background: #20283b; }}
    .chips {{ display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }}
    .chip {{ background: #19202c; border: 1px solid #263146; color: var(--text); padding: 8px 12px; border-radius: 999px; font-size: 14px; cursor: pointer; }}
    .chip.active {{ background: #24304a; border-color: #2f3d5a; }}
    .section {{ margin-top: 24px; }}
    .year-block {{ background: var(--card); border: 1px solid #232a36; border-radius: var(--radius); padding: 16px; margin-bottom: 16px; }}
    .year-head {{ display:flex; align-items:center; justify-content:space-between; gap:12px; }}
    .year-title {{ font-size: 20px; margin: 0; display:flex; align-items:center; gap:10px; }}
    .year-title .pill {{ font-size: 12px; color: var(--bg); background: var(--accent); padding: 4px 8px; border-radius: 999px; }}
    .songs {{ margin-top: 10px; display: grid; grid-template-columns: 1fr; gap: 8px; }}
    .song {{ display:flex; flex-direction: column; gap: 2px; padding: 12px; background: #121722; border: 1px solid #1f2634; border-radius: 10px; }}
    .song .name {{ font-weight: 600; }}
    .song .meta {{ color: var(--muted); font-size: 13px; }}
    .muted {{ color: var(--muted); }}
    .foot {{ color: var(--muted); font-size: 13px; margin-top: 24px; }}
    .toolbar {{ display:flex; gap:10px; flex-wrap: wrap; }}
    @media (min-width: 640px) {{ .songs {{ grid-template-columns: repeat(2, 1fr); }} }}
    @media (min-width: 960px) {{ .songs {{ grid-template-columns: repeat(3, 1fr); }} }}
  </style>
</head>
<body>
  <header class="hero">
    <div class="wrap">
      <h1 class="title">كل أغاني كاظم الساهر <span style="color:var(--accent)">حسب السنة</span></h1>
      <p class="subtitle">اكتب سنة الإصدار (مثلاً: 1998) أو اختر سنة من الأسفل — وستظهر لك كل الأغاني التي صدرت في تلك السنة.</p>
      <div class="search-row">
        <input id="yearInput" class="input" type="number" inputmode="numeric" placeholder="ابحث بالسنة… (1994 → 2025)" />
        <div class="toolbar">
          <button id="clearBtn" class="btn" title="مسح البحث">مسح</button>
          <button id="downloadBtn" class="btn" title="تنزيل قاعدة البيانات (JSON)">تنزيل البيانات</button>
        </div>
      </div>
      <div id="yearChips" class="chips" aria-label="سنوات متاحة"></div>
    </div>
  </header>

  <main class="wrap section">
    <div id="results"></div>
    <p id="emptyMsg" class="muted" style="display:none">لا توجد نتائج لهذه السنة حتى الآن.</p>
    <div class="foot">
      <span>نُسخة مبدئية للبيانات — سهلة الإضافة والتعديل عبر ملف <code>data/songs.json</code> داخل الموقع.</span>
    </div>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const resultsEl = $("#results");
    const yearInput = $("#yearInput");
    const yearChips = $("#yearChips");
    const emptyMsg = $("#emptyMsg");
    const clearBtn = $("#clearBtn");
    const downloadBtn = $("#downloadBtn");

    let allSongs = [];
    let years = [];

    function groupByYear(items) {{
      const map = new Map();
      items.forEach(s => {{
        const y = Number(s.year);
        if (!map.has(y)) map.set(y, []);
        map.get(y).push(s);
      }});
      // sort songs within year by title
      for (const arr of map.values()) arr.sort((a,b) => a.title.localeCompare(b.title, 'ar'));
      // return sorted array of [year, songs[]] descending by year
      return [...map.entries()].sort((a,b) => b[0] - a[0]);
    }}

    function renderChips(years) {{
      yearChips.innerHTML = "";
      years.slice(0, 42).forEach(y => {{
        const chip = document.createElement("button");
        chip.className = "chip";
        chip.textContent = y;
        chip.setAttribute("data-year", y);
        chip.addEventListener("click", () => {{
          yearInput.value = y;
          applyFilter();
          // focus results
          const block = document.getElementById("year-"+y);
          if (block) block.scrollIntoView({{ behavior: "smooth", block: "start" }});
        }});
        yearChips.appendChild(chip);
      }});
    }}

    function render(list) {{
      resultsEl.innerHTML = "";
      const groups = groupByYear(list);
      if (groups.length === 0) {{
        emptyMsg.style.display = "block";
        return;
      }}
      emptyMsg.style.display = "none";

      groups.forEach(([year, songs]) => {{
        const wrap = document.createElement("section");
        wrap.className = "year-block";
        wrap.id = "year-"+year;

        const head = document.createElement("div");
        head.className = "year-head";
        head.innerHTML = `<h2 class="year-title"><span class="pill">{{year}}</span> أغاني {{year}}</h2>`;
        wrap.appendChild(head);

        const listEl = document.createElement("div");
        listEl.className = "songs";

        songs.forEach(s => {{
          const card = document.createElement("div");
          card.className = "song";
          card.innerHTML = `<div class="name">${{s.title}}</div>
                            <div class="meta">${{s.album ? ("الألبوم: " + s.album) : ""}}</div>`;
          listEl.appendChild(card);
        }});

        wrap.appendChild(listEl);
        resultsEl.appendChild(wrap);
      }});
    }}

    function applyFilter() {{
      const q = yearInput.value.trim();
      yearChips.querySelectorAll(".chip").forEach(c => c.classList.remove("active"));

      if (!q) {{
        render(allSongs);
        return;
      }}
      const y = Number(q);
      if (isNaN(y)) {{
        render([]);
        return;
      }}
      const filtered = allSongs.filter(s => Number(s.year) === y);
      // mark chip
      const chip = yearChips.querySelector(`[data-year="${{y}}"]`);
      if (chip) chip.classList.add("active");
      render(filtered);
      if (filtered.length) {{
        const block = document.getElementById("year-"+y);
        if (block) block.scrollIntoView({{ behavior: "smooth", block: "start" }});
      }}
    }}

    function initFromParam() {{
      const params = new URLSearchParams(location.search);
      const y = params.get("year");
      if (y) {{
        yearInput.value = y;
        applyFilter();
      }}
    }}

    async function init() {{
      const res = await fetch("data/songs.json");
      allSongs = await res.json();
      // collect years (desc), unique
      years = [...new Set(allSongs.map(s => Number(s.year)))].sort((a,b)=>b-a);
      renderChips(years);
      render(allSongs);
      initFromParam();
    }}

    clearBtn.addEventListener("click", () => {{ yearInput.value = ""; applyFilter(); }});
    downloadBtn.addEventListener("click", () => {{
      const blob = new Blob([JSON.stringify(allSongs, null, 2)], {{type: "application/json"}});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "songs.json";
      a.click();
      URL.revokeObjectURL(url);
    }});

    yearInput.addEventListener("input", () => {{ applyFilter(); }});
    init();
  </script>
</body>
</html>
